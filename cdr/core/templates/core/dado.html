{% extends "core/base.html" %}
{% load static %}

{% block title %}Dados{% endblock %}

{% block custom %}
  <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>
  <link rel="stylesheet" href="{% static 'css/dado.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}

{% block content %}
<div class="container-fluid h-100 mt-4">
	<div class="row h-100">
		<div class="col-3" style="height:100vh; overflow:hidden;">
			<div class="container px-0">
				<div class="row mt-1">
					<div class="col-12">
						<h4 class="d-none d-md-block text-center">Lanzador de Dados</h1>
					</div>
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="d-flex">
									<label class="sr-only" for="rollConfig">Ingresa la configuracion del dado</label>
									<div class="input-group mr-2">
										<input type="text" class="form-control flex-grow-1 flex-shrink-1" id="rollConfig" value="1d20">
										<div class="input-group-append">
											<a href="#" id="rollHelp" class="input-group-text">?</a>
											<button class="btn btn-primary desktop-throw" id="desktop-throw" onclick="sound.play()">
												<i class="fas fa-dice"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							<div class="card-body">
								<h1 id="resultText" class="text-center mb-0">&nbsp;</h1>
							</div>
						</div>
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="d-flex">
									<div class="flex-grow-1 flex-shrink-1">Selecciona un dado para lanzar</div>
								</div>
							</div>
							<div class="list-group list-group-flush">
								<div class="card-body p-3">
									<div class="dice-selector">
										<button class="btn btn-outline-primary dice-button" data-dice="1d4">D4</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d6">D6</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d8">D8</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d10">D10</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d12">D12</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d20">D20</button>
										<button class="btn btn-outline-primary dice-button" data-dice="1d100">D100</button>
									</div>
								</div>
								<div class="list-group-item p-2">
									<div class="list-group" id="savedRolls" style="display: none;">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="d-flex">
									<div class="flex-grow-1 flex-shrink-1">Historial de Lanzamientos</div>
									<button id="clearLog" type="submit" class="btn btn-secondary btn-sm">Borrar</button>
								</div>
							</div>
							<div class="card-body p-2">
								<div id="rollLog"></div>
							</div>
						</div>
					</div>
				</div>
				<!-- <div class="row mt-1 d-none d-md-block">
					<div class="col-12 small text-muted">
						Adapted from <a href="http://a.teall.info/dice/">Teal Dice</a> by Anton Natarov. Utilizes <a href="https://getbootstrap.com/">Bootstrap component library</a>, <a href="https://threejs.org/">THREE rendering library</a> and <a href="http://www.cannonjs.org/">CANNON physics library</a>. Velvet background retrieved from <a href="https://www.pinterest.com/pin/137359857358954784/">Pinterest</a> (attribution unknown).
					</div>
				</div> -->
			</div>
		</div>
		<div class="col-9 velvet-lining h-100 p-0" id="canvas">
		</div>
	</div>
</div>

<!-- Botones del celular -->
 
<div class="mobile-dice-buttons d-md-none">
    <div class="row mt-3">
        <div class="col-12 text-center">
            <h5>Elige:</h5>
            <div class="dice-column" role="group" aria-label="Dice buttons">
				<button class="btn btn-outline-primary dice-button" data-dice="1d100">D100</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d20">D20</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d12">D12</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d10">D10</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d8">D8</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d6">D6</button>
				<button class="btn btn-outline-primary dice-button" data-dice="1d4">D4</button>
            </div>
        </div>
    </div>
</div>
    <!-- Panel mÃ³vil (oculto en desktop) -->
    <!-- Botones flotantes -->
	<div class="mobile-btns">
		<button class="floating-btn saved-btn" id="mobileSavedDice">
			<svg class="eye-icon" viewBox="0 0 24 24" width="24" height="24">
				<!-- Ojo abierto -->
				<path class="eye-open" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
				<!-- Ojo cerrado -->
				<g class="eye-closed" opacity="0">
					<path d="M12 6.5c-3.79 0-7.17 2.13-8.82 5.5 1.65 3.37 5.02 5.5 8.82 5.5s7.17-2.13 8.82-5.5C19.17 8.63 15.79 6.5 12 6.5zm0 10c-2.48 0-4.5-2.02-4.5-4.5S9.52 7.5 12 7.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5z"/>
					<path d="M2 2L22 22" stroke="currentColor" stroke-width="2"/>
				</g>
			</svg>
		</button>
		<button type="submit" class="btn btn-primary floating-btn throw-btn" id="throw">
			<i class="fas fa-dice"></i>
		</button>
		<button class="floating-btn history-btn" id="mobileHistory">
			<i class="fas fa-history"></i>
		</button>
	</div>
</div>

<!-- Modales -->
<div class="mobile-modal" id="savedDiceModal">
    <div class="modal-content">
        <div class="modal-header">
            <h5>Dados Guardados</h5>
            <button class="modal-close">&times;</button>
        </div>
        <div id="mobileSavedRolls"></div>
    </div>
</div>

<div class="mobile-modal" id="historyModal">
    <div class="modal-content">
        <div class="modal-header">
            <h5>Historial de Lanzamientos</h5>
            <button class="modal-close">&times;</button>
        </div>
        <div id="mobileRollLog"></div>
    </div>
</div>
<script>
	document.addEventListener('DOMContentLoaded', function() {
		const desktopThrow = document.getElementById('desktopThrow');
		const mainThrow = document.getElementById('throw');
		
		if (desktopThrow && mainThrow) {
			desktopThrow.addEventListener('click', function(e) {
				e.preventDefault();
				mainThrow.click();
			});
		}
	});
</script>
<!-- partial -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/103/three.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js'></script>
<script  src="{% static 'js/dado.js' %}"></script>


{% endblock %}

{% extends "core/base.html" %}
{% block title %}Gestor de Usuarios{% endblock %}
{% load static %}
{% block custom %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="{% static 'js/gestor_usuarios.js' %}"></script>
{% endblock %}

{% block content %}



<div class="container mt-5 p-3" style="background-color: #0D1D13; color: #C8D6C3; border: 1px solid #1A3B2A; border-radius: 10px;">
    {% if user.is_authenticated and user.is_staff %}
        <div class="mb-2 text-end">
            <a href="{% url 'crear_usuario' %}" class="btn btn-icon">
                <i class="fas fa-plus" style="font-size: 1.5rem; color: #A1C181;" title="Agregar Noticia"></i>
            </a>
        </div>
    {% endif %}

    <div class="row">
        {% for message in messages %}
            <div class="col-12">
                <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-success{% endif %} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            </div>
        {% endfor %}
    </div>



    <!-- Tabla para pantallas grandes -->
    <div class="d-none d-lg-block table-responsive">
        <table id="tablaUsuarios" class="table table-dark table-hover" style="background-color: #1A3B2A; border: 1px solid #A1C181;">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Email</th>
                    <th>Activo</th>
                    <th>Tipo</th>
                    <th>Carrera</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for usuario in usuarios %}
                <tr>
                    <td >                        
                        <a href="{% url 'ver_perfil_usuario' username=usuario.username %}"
                        data-bs-toggle="tooltip" 
                        data-bs-placement="top" 
                        data-bs-html="true"
                        title="<strong>Email:</strong> {{ usuario.email }}<br>
                               <strong>RUT:</strong> {{ usuario.perfil.rut|default:'No disponible' }}<br>
                               <strong>Carrera:</strong> {{ usuario.perfil.carrera|default:'No especificada' }}">
                        {{ usuario.get_full_name }}
                        </a>
                    </td>
                    <td>{{ usuario.email }}</td>
                    <td>
                        {% if usuario.is_active %}
                        <span class="text-success">Sí</span>
                        {% else %}
                        <span class="text-danger">No</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if usuario.is_staff %}
                        <span class="badge bg-primary">Administrador</span>
                        {% else %}
                        <span class="badge bg-secondary">Usuario Normal</span>
                        {% endif %}
                    </td>
                    <td>{{ usuario.perfil.carrera }}</td>
                    <td class="text-center">
                        {% if not usuario.is_staff %}
                            {% if usuario.is_active %}
                                <a href="{% url 'deshabilitar_usuario' usuario.id %}" class="btn btn-sm btn-danger">Deshabilitar</a>
                            {% else %}
                                <a href="{% url 'habilitar_usuario' usuario.id %}" class="btn btn-sm btn-success">Habilitar</a>
                            {% endif %}
                        {% else %}
                            <span style="color: aliceblue;">No disponible</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Vista tipo tarjetas para pantallas pequeñas -->
    <div class="d-lg-none">
        {% for usuario in usuarios %}
        <div class="card mb-3 shadow-sm" style="background-color: #1A3B2A; border: 1px solid #A1C181; color: #C8D6C3;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="card-title mb-0" style="color: #A1C181;">{{ usuario.get_full_name }}</h5>
                    <span class="badge {% if usuario.is_staff %}bg-primary{% else %}bg-secondary{% endif %}">
                        {% if usuario.is_staff %}Administrador{% else %}Usuario Normal{% endif %}
                    </span>
                </div>
                <hr>
                <p>
                    <strong>Email:</strong> {{ usuario.email }}<br>
                    <strong>Activo:</strong>
                    {% if usuario.is_active %}
                        <span class="text-success">Sí</span>
                    {% else %}
                        <span class="text-danger">No</span>
                    {% endif %}<br>
                    <strong>Carrera:</strong> {{ usuario.perfil.carrera }}
                </p>
                {% if not usuario.is_staff %}
                <div class="d-flex justify-content-end">
                    {% if usuario.is_active %}
                        <a href="{% url 'deshabilitar_usuario' usuario.id %}" class="btn btn-sm btn-danger">Deshabilitar</a>
                    {% else %}
                        <a href="{% url 'habilitar_usuario' usuario.id %}" class="btn btn-sm btn-success">Habilitar</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
